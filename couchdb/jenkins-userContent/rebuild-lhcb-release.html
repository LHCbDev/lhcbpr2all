<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
<script>
    var JENKINS_JOB = 'https://lhcb-jenkins.cern.ch/job/lhcb-release';
    function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);
        return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }
    $(function(){
        var data = {
            delay: '60sec',
            projects_list: getParameterByName('projects_list'),
            platforms: getParameterByName('platforms'),
            build_tool: getParameterByName('build_tool')
        };
        if (data.projects_list && data.platforms){
            $.ajax({
                url: JENKINS_JOB + '/buildWithParameters',
                method: 'POST',
                data: data
            }).done(function(){
                document.location = JENKINS_JOB;
            }).fail(function(){
                alert('Error starting the job.');
                document.location = JENKINS_JOB;
            });
        } else {
            alert('Missing parameters for the rebuild.');
            document.location = JENKINS_JOB;
        }
    });
    </script>
</head>
<body>
	<p>Redirecting to Jenkins...</p>
</body>
</html>
